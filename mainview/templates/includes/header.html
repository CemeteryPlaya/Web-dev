{% load static %}
<header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center">
            <a href="/" class="text-2xl font-['Pacifico'] text-primary mr-8">
                <img src="{% static 'images/logo.png' %}" style="height: 50px; width: 50px;" alt="Inter Cargo Logo">
            </a>
            <!-- Навигация для десктопа (скрыта на мобильных) -->
            <nav id="desktop-menu" class="hidden md:flex space-x-8">
                <a href="/" class="text-gray-900 font-medium hover:text-primary transition">Главная</a>
                <a href="{% url 'education' %}" class="text-gray-700 hover:text-primary transition">Обучение</a>
                <a href="{% url 'about' %}" class="text-gray-700 hover:text-primary transition">О компании</a>
            </nav>
        </div>
        <div class="flex items-center space-x-4">
            <!-- Ссылки на соцсети ... (оставляем как есть) -->
            <a href="https://www.instagram.com/inter_cargo_trz/" class="w-10 h-10 flex items-center justify-center rounded-full bg-white-100 hover:bg-white-100 transition hidden md:flex" target="_blank" rel="noopener noreferrer">
                <img src="{% static 'images/instagram.svg' %}" style="height: 35px; width: 35px;" alt="Instagram">
            </a>
            <a href="https://t.me/inter_cargo" class="w-10 h-10 flex items-center justify-center rounded-full bg-white-100 hover:bg-white-100 transition hidden md:flex" target="_blank" rel="noopener noreferrer">
                <img src="{% static 'images/telegram.svg' %}" style="height: 35px; width: 35px;" alt="Telegram">
            </a>
            <a href="https://wa.me/77066440624" class="w-10 h-10 flex items-center justify-center rounded-full bg-white-100 hover:bg-white-100 transition hidden md:flex" target="_blank" rel="noopener noreferrer">
                <img src="{% static 'images/whatsapp.svg' %}" style="height: 35px; width: 35px;" alt="WhatsApp">
            </a>
            {% if user.is_authenticated %}
                <div class="relative">
                    <button id="notification-button" class="relative w-10 h-10 flex items-center justify-center rounded-full bg-gray-500 hover:bg-black transition" title="Уведомления">
                        <i class="ri-notification-3-fill text-white text-xl"></i>
                        {% if unread > 0 %}
                            <span id="notification-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-1 text-xs font-bold leading-none text-white bg-red-600 rounded-full">
                                {{ unread }}
                            </span>
                        {% endif %}
                    </button>
                    <!-- Контейнер для уведомлений -->
                    <div class="relative flex items-center">
                        <!-- Оболочка уведомлений -->
                        <div class="relative">
                            <!-- Кнопка -->
                            <button id="notif-btn" class="relative focus:outline-none flex items-center justify-center mt-[2px]">
                                <i class="fa fa-bell text-2xl"></i>
                                {% if user.notifications.unread.count > 0 %}
                                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1">
                                    {{ user.notifications.unread.count }}
                                </span>
                                {% endif %}
                            </button>

                            <!-- Выпадающее окно -->
                            <div id="notification-dropdown"
                                class="fixed sm:absolute sm:right-0 sm:left-auto left-1/2 top-[70px] sm:top-auto -translate-x-1/2 sm:translate-x-0 w-80 max-w-[90vw] bg-white border rounded-xl shadow-lg z-50 hidden overflow-hidden">
                                <div class="p-3 font-semibold border-b text-center sm:text-left">Уведомления</div>
                                <ul class="max-h-60 overflow-y-auto">
                                    {% for notif in user.notifications.all|slice:":5" %}
                                    <li class="px-4 py-2 text-sm {% if not notif.is_read %}bg-gray-100{% endif %}">
                                        {{ notif.message }}
                                        <div class="text-xs text-gray-500">{{ notif.created_at|date:"d.m.Y H:i" }}</div>
                                    </li>
                                    {% empty %}
                                    <li class="px-4 py-2 text-sm text-gray-500">Нет уведомлений</li>
                                    {% endfor %}
                                </ul>
                                <div class="p-2 text-center border-t">
                                    <a href="{% url 'notifications' %}" class="text-primary text-sm hover:underline">Все уведомления</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="{% url 'profile' %}" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-500 hover:bg-black transition hidden md:flex" title="Профиль">
                    <i class="ri-user-fill text-white"></i>
                </a>
                <form method="post" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                    <button type="submit" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-500 hover:bg-black transition hidden md:flex" title="Выйти">
                        <i class="ri-logout-box-line text-white"></i>
                    </button>
                </form>
            {% else %}
                <a href="{% url 'login' %}" class="text-sm text-gray-700 hover:text-primary transition hidden md:inline">Войти</a>
                <a href="{% url 'register' %}" class="text-sm text-gray-700 hover:text-primary transition hidden md:inline">Регистрация</a>
            {% endif %}
            <!-- Кнопка меню для мобильных устройств -->
            <button id="mobile-menu-toggle" class="md:hidden w-10 h-10 flex items-center justify-center text-gray-900 focus:outline-none" aria-label="Открыть меню" data-is-authenticated="{{ user.is_authenticated|yesno:'true,false' }}">
                <i class="ri-menu-line text-xl"></i>
            </button>
        </div>
    </div>

    <!-- Стандартное мобильное меню (для неаутентифицированных пользователей) -->
    <div id="mobile-menu" class="hidden md:hidden fixed inset-0 z-40 bg-white">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-4 border-b">
                <a href="/" class="text-2xl font-['Pacifico'] text-primary">
                    <img src="{% static 'images/logo.png' %}" style="height: 40px; width: 40px;" alt="Inter Cargo Logo">
                </a>
                <button id="mobile-menu-close" class="text-gray-900 focus:outline-none" aria-label="Закрыть меню">
                    <i class="ri-close-line text-2xl"></i>
                </button>
            </div>
            <nav class="flex-grow flex flex-col p-4 space-y-4">
                <a href="/" class="text-gray-900 font-medium hover:text-primary transition py-2">Главная</a>
                <a href="{% url 'education' %}" class="text-gray-700 hover:text-primary transition py-2">Обучение</a>
                <a href="{% url 'about' %}" class="text-gray-700 hover:text-primary transition py-2">О компании</a>
                {% if not user.is_authenticated %}
                    <a href="{% url 'login' %}" class="text-gray-700 hover:text-primary transition py-2">Войти</a>
                    <a href="{% url 'register' %}" class="text-gray-700 hover:text-primary transition py-2">Регистрация</a>
                {% endif %}
            </nav>
            <div class="p-4 border-t">
                <div class="flex justify-center space-x-6 hidden md:flex">
                     <a href="https://www.instagram.com/inter_cargo_trz/" class="w-8 h-8 flex items-center justify-center rounded-full bg-white-100 hover:bg-white-100 transition" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'images/instagram.svg' %}" style="height: 28px; width: 28px;" alt="Instagram">
                    </a>
                    <a href="https://t.me/inter_cargo" class="w-8 h-8 flex items-center justify-center rounded-full bg-white-100 hover:bg-white-100 transition" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'images/telegram.svg' %}" style="height: 28px; width: 28px;" alt="Telegram">
                    </a>
                    <a href="https://wa.me/77066440624" class="w-8 h-8 flex items-center justify-center rounded-full bg-white-100 hover:bg-white-100 transition" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'images/whatsapp.svg' %}" style="height: 28px; width: 28px;" alt="WhatsApp">
                    </a>
                </div>
                 {% if user.is_authenticated %}
                    <div class="mt-4 flex items-center justify-between md:hidden hidden md:flex">
                        <a href="{% url 'profile' %}" class="flex items-center text-gray-900 hover:text-primary transition">
                            <i class="ri-user-fill mr-2"></i> Профиль
                        </a>
                        <form method="post" action="{% url 'logout' %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="text-gray-700 hover:text-primary transition">
                                <a class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-500 hover:bg-black transition" title="Выйти">
                                    <i class="ri-logout-box-line text-white"></i>
                                </a>
                            </button>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- Оверлей для закрытия стандартного меню по клику вне его области -->
    <div id="mobile-menu-overlay" class="hidden fixed inset-0 z-30 bg-black bg-opacity-50"></div>

    <!-- Включаем мобильный сайдбар -->
    {% include 'includes/m_sidebar.html' %}
</header>